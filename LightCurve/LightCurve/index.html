


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.0">
    
    
      
        <title>Exoplanet Light Curve Analysis with emcee and UltraNest - Demonstrations of MCMC and Nested Samplers in Physics</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.b5d04df8.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-emcee-and-ultranest-to-model-the-light-curves-from-kepler-10" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Demonstrations of MCMC and Nested Samplers in Physics" class="md-header-nav__button md-logo" aria-label="Demonstrations of MCMC and Nested Samplers in Physics">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Demonstrations of MCMC and Nested Samplers in Physics
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Exoplanet Light Curve Analysis with emcee and UltraNest
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Demonstrations of MCMC and Nested Samplers in Physics" class="md-nav__button md-logo" aria-label="Demonstrations of MCMC and Nested Samplers in Physics">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Demonstrations of MCMC and Nested Samplers in Physics
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../PyMC3_GRS/PyMC3_GRS/" title="Gamma-Ray Spectroscopy with PyMC3 and dynesty" class="md-nav__link">
      Gamma-Ray Spectroscopy with PyMC3 and dynesty
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Exoplanet Light Curve Analysis with emcee and UltraNest
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Exoplanet Light Curve Analysis with emcee and UltraNest" class="md-nav__link md-nav__link--active">
      Exoplanet Light Curve Analysis with emcee and UltraNest
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#useful-imports" class="md-nav__link">
    Useful imports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viewing-the-data" class="md-nav__link">
    Viewing the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-model" class="md-nav__link">
    The model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-emcee" class="md-nav__link">
    Modelling with emcee
  </a>
  
    <nav class="md-nav" aria-label="Modelling with emcee">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-comparisons" class="md-nav__link">
    Model comparisons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-ultranest" class="md-nav__link">
    Modelling with UltraNest
  </a>
  
    <nav class="md-nav" aria-label="Modelling with UltraNest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data_1" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results_1" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior_1" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-comparisons_1" class="md-nav__link">
    Model comparisons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Sunspots2/Sunspots2/" title="Solar Cycle Analysis with Zeus and Nestle" class="md-nav__link">
      Solar Cycle Analysis with Zeus and Nestle
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../gravwaves/gravwaves/" title="Gravitational Wave Parameter Estimation with bilby" class="md-nav__link">
      Gravitational Wave Parameter Estimation with bilby
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../particleID/particleID/" title="Particle Identification in Proton-Proton Collisions with PyStan" class="md-nav__link">
      Particle Identification in Proton-Proton Collisions with PyStan
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#useful-imports" class="md-nav__link">
    Useful imports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viewing-the-data" class="md-nav__link">
    Viewing the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-model" class="md-nav__link">
    The model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-emcee" class="md-nav__link">
    Modelling with emcee
  </a>
  
    <nav class="md-nav" aria-label="Modelling with emcee">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-comparisons" class="md-nav__link">
    Model comparisons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-ultranest" class="md-nav__link">
    Modelling with UltraNest
  </a>
  
    <nav class="md-nav" aria-label="Modelling with UltraNest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data_1" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results_1" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior_1" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-comparisons_1" class="md-nav__link">
    Model comparisons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="using-emcee-and-ultranest-to-model-the-light-curves-from-kepler-10">Using emcee and UltraNest to model the light curves from Kepler-10</h1>
<p>Kepler-10 is a star located roughly 608 lightyears from Earth. Kepler-10 was targeted by NASA in their search for an Earth-like exoplanet, and in 2011 the first exoplanet orbiting Kepler-10 was discovered. The planet, Kepler-10b, is a rocky planet with 1.4x the radius of Earth, and 3.7x the mass.</p>
<p>As Kepler-10b passes in front of its star, it obstructs some flux (the light energy per unit time per unit area) from the star, casting a shadow towards Earth. We see this as a slight periodic dip in light intesity, occuring every time the exoplanet is infront of its star. Measuring the light curve (flux as a function of time) from a star with an exoplanet is called "transit detection", and can be used to infer the existense of an exoplanet and find the properties of the star-planet system.</p>
<p>In this example, I will create a model describing the flux of a star with, a single orbiting planet, as a function of time. I will then use the "emcee" and "UltraNest" samplers to fit the model parameters to some real Kepler-10 light curve data, provided by NASA.</p>
<h2 id="useful-imports">Useful imports</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># numpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># scipy</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">gammaln</span><span class="p">,</span> <span class="n">ndtri</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="c1"># astropy</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>

<span class="c1"># plotting</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1"># samplers</span>
<span class="kn">import</span> <span class="nn">emcee</span> <span class="k">as</span> <span class="nn">mc</span>
<span class="kn">import</span> <span class="nn">ultranest</span>
<span class="kn">import</span> <span class="nn">ultranest.stepsampler</span> <span class="k">as</span> <span class="nn">stepsampler</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;emcee version: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UltraNest version: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ultranest</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>

<span class="c1"># misc</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span> <span class="k">as</span> <span class="n">timer</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">emcee version: 3.0.2</span>
<span class="err">UltraNest version: 2.2.2</span>
</code></pre></div>


<h2 id="viewing-the-data">Viewing the data</h2>
<p>Light curve models can vary from simple square shaped transits, to extremely complicated transits involving limb-darkening and other effects. To decide which model is most appropriate, we need to first see the data we will be using.</p>
<p>The light curve data is in the form of a FITS file. These files can be easily loaded into a Table format (simillar to a Pandas DataFrame) using astropy. The data is quite large, so I chose to look at the first 1325 data points only. Whilst extracting the data, any data points with a flux of "nan" need to be removed from both the "flux" and "time" lists.</p>
<div class="codehilite"><pre><span></span><code><span class="n">table</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;kplr011904151-2010265121752_llc.fits&quot;</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">flux_orig</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PDCSAP_FLUX&#39;</span><span class="p">][:</span><span class="mi">1325</span><span class="p">]</span>
<span class="n">time_orig</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][:</span><span class="mi">1325</span><span class="p">]</span>
<span class="n">flux</span> <span class="o">=</span> <span class="p">[</span><span class="n">flux_orig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux_orig</span><span class="p">))</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">flux_orig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;nan&quot;</span><span class="p">]</span>
<span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_orig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_orig</span><span class="p">))</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">flux_orig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;nan&quot;</span><span class="p">]</span>
</code></pre></div>


<p>Now, we can plot the light curve we will be using and decide how complicated our model needs to be. Of the two plots below, the first shows the whole light curve that I'll be using, and the second shows a "zoomed in" segment of the light curve. </p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1"># plot all useful data</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>

<span class="c1"># plot zoomed in view of transits</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time / days&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">541325</span><span class="p">,</span> <span class="mi">541700</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">545</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Kepler-10 light curves showing evidence of exoplanet transits&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_8_0.png" /></p>
<p>The above plot shows regular dips in flux, as expected from exoplanet transits. The dips appear to be "V-shaped", with sloped sides and a flat bottom. This suggests we could use a model of regular trapezium shaped flux drops. However, the slopes are fairly steep, so we could also use a much simpler square shaped flux drop instead. This would save on time, but may come at the cost of accuracy.</p>
<h2 id="the-model">The model</h2>
<p>Below is a diagram showing which parameters are needed to define a trapezium shaped transit (left), and how I will go about implementing the model in Python (right). I started with a simple recurring step function, then modified the step to have the triangular shape with height "h", which can be calculated using basic trigonometry. Finally, I added a hard floor at a flux change of df, to create the trapezium shape. The square transit shape is simillar, but tt and tf are equal.</p>
<p><img alt="" src="../transits.png" title="Model" /></p>
<p>Using this, I defined a the function that will be used to model the transit:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">transit</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">tf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flux, from a uniform star source with single orbiting planet, as a function of time</span>
<span class="sd">    :param time: 1D array, input times</span>
<span class="sd">    :param f: unobscured flux, max flux level</span>
<span class="sd">    :param df: ratio of obscured to unobscured flux</span>
<span class="sd">    :param p: period of planet&#39;s orbit</span>
<span class="sd">    :param tt: total time of transit</span>
<span class="sd">    :param tf: time during transit in which flux doesn&#39;t change</span>
<span class="sd">    :param off: time offset. A value of 0 means the transit begins immidiately</span>
<span class="sd">    :param square: If True, the shape of the transit will be square (tt == tf)</span>
<span class="sd">    :return: 1D array, flux from the star</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">if</span> <span class="n">tf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">tt</span>
    <span class="k">if</span> <span class="n">tt</span> <span class="o">&lt;=</span> <span class="n">tf</span><span class="p">:</span>
        <span class="c1"># Default to square shaped transit </span>
        <span class="n">square</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">square</span><span class="p">:</span>
        <span class="c1"># define slope of sides of trapezium </span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">df</span><span class="o">*</span><span class="n">tt</span><span class="o">/</span><span class="p">(</span><span class="n">tt</span><span class="o">-</span><span class="n">tf</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="n">tt</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">off</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">tt</span><span class="p">:</span>
            <span class="c1"># transit</span>
            <span class="c1"># square shaped transit</span>
            <span class="k">if</span> <span class="n">square</span><span class="p">:</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">))</span>

            <span class="c1"># trapezium shaped transit</span>
            <span class="k">elif</span> <span class="n">j</span><span class="o">/</span><span class="n">tt</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="c1"># first half of transit</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="n">grad</span><span class="o">*</span><span class="n">j</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">):</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># last half of transit</span>
                <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">grad</span><span class="o">*</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">f</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">):</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no transit</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div>


<p>I'll be using both a trapezium and square shape transit in tandem throughout this example, and I'll compare the performance and accuracies of both models.</p>
<h2 id="modelling-with-emcee">Modelling with emcee</h2>
<p>Now that we know the parameters that will describe the model, we can start guessing at the parameter priors by using the plots above. Due to the noise, I'll use a uniform prior on f, but a normal prior on other parameters. Since the square transit model does not require the "tf" parameter, we can omit it from the list of square transit priors for a little extra time save. This model is quite complicated with six parameters, and eyeballing the values of each parameter can be tricky. Using a little trial and error, I came up with the following guesses:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># uniform prior on flux</span>
<span class="n">f_min</span> <span class="o">=</span> <span class="mf">4.9</span>
<span class="n">f_max</span> <span class="o">=</span> <span class="mf">5.8</span>

<span class="c1"># normal prior on flux drop</span>
<span class="n">df_mu</span> <span class="o">=</span> <span class="mf">0.19</span>
<span class="n">df_sig</span> <span class="o">=</span> <span class="mf">0.005</span>

<span class="c1"># normal prior on period</span>
<span class="n">p_mu</span> <span class="o">=</span> <span class="mf">0.8372</span>
<span class="n">p_sig</span> <span class="o">=</span> <span class="mf">0.008</span>

<span class="c1"># normal prior on total transit time</span>
<span class="n">tt_mu</span> <span class="o">=</span> <span class="mf">0.145</span>
<span class="n">tt_sig</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># normal prior on flat transit time</span>
<span class="n">tf_mu</span> <span class="o">=</span> <span class="mf">0.143</span>
<span class="n">tf_sig</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># normal prior on offset</span>
<span class="n">off_mu</span> <span class="o">=</span> <span class="mf">0.1502</span>
<span class="n">off_sig</span> <span class="o">=</span> <span class="mf">0.0008</span>

<span class="n">priors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f_min</span><span class="p">,</span> <span class="n">f_max</span><span class="p">),</span> <span class="p">(</span><span class="n">df_mu</span><span class="p">,</span> <span class="n">df_sig</span><span class="p">),</span> <span class="p">(</span><span class="n">p_mu</span><span class="p">,</span> <span class="n">p_sig</span><span class="p">),</span>
          <span class="p">(</span><span class="n">tt_mu</span><span class="p">,</span> <span class="n">tt_sig</span><span class="p">),</span> <span class="p">(</span><span class="n">tf_mu</span><span class="p">,</span> <span class="n">tf_sig</span><span class="p">),</span> <span class="p">(</span><span class="n">off_mu</span><span class="p">,</span> <span class="n">off_sig</span><span class="p">)]</span>
<span class="c1"># remove tf for square transit parameters</span>
<span class="n">priors_square</span> <span class="o">=</span> <span class="n">priors</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">priors</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</code></pre></div>


<h3 id="sampling-the-data">Sampling the data</h3>
<p>The "emcee" sampler requires the user to provide a prior, likelihood, and posterior function, all in their log forms. These functions are very simillar for the trapezium and square shaped transit models; the key difference being the "tf" parameter is omitted for the square model. Since I decided on using normal and uniform priors for each parameter, The log of the prior takes the following forms:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">logprior</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log of the prior for a trapezium shaped transit light curve model</span>
<span class="sd">    :param theta: tuple or list containing each parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">priors</span><span class="p">)):</span>
        <span class="c1"># sum log priors from each parameter</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># prior for uniform parameters</span>
            <span class="k">if</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lprior</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># prior for non-uniform parameters</span>
            <span class="n">lprior</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">lprior</span>

<span class="k">def</span> <span class="nf">logprior_square</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log of the prior for a square shaped transit light curve model</span>
<span class="sd">    :param theta: tuple or list containing each parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">priors_square</span><span class="p">)):</span>
        <span class="c1"># sum log priors from each parameter</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># prior for uniform parameters</span>
            <span class="k">if</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lprior</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># prior for non-uniform parameters</span>
            <span class="n">lprior</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">lprior</span>
</code></pre></div>


<p>The likelihood takes the form of a Poisson distribution, since flux is a non-negative quantity. The expected value of the likelihood "lmbda" is found using the "transit" function defined above.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log likelihood of the trapezium shpaed transit light curve model</span>
<span class="sd">    :param theta: tuple or list containing each parameter</span>
<span class="sd">    :param obs: list or array containing the observed flux of each data point</span>
<span class="sd">    :param times: list or array containing the times at which each data point is recorded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># unpack parameters</span>
    <span class="n">f_like</span><span class="p">,</span> <span class="n">df_like</span><span class="p">,</span> <span class="n">p_like</span><span class="p">,</span> <span class="n">tt_like</span><span class="p">,</span> <span class="n">tf_like</span><span class="p">,</span> <span class="n">off_like</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="c1"># expected value</span>
    <span class="n">lmbda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">transit</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">f_like</span><span class="p">,</span> <span class="n">df_like</span><span class="p">,</span> <span class="n">p_like</span><span class="p">,</span> <span class="n">tt_like</span><span class="p">,</span> <span class="n">tf_like</span><span class="p">,</span> <span class="n">off</span><span class="o">=</span><span class="n">off_like</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lmbda</span><span class="p">))</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">loglike_square</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log likelihood of the square shpaed transit light curve model</span>
<span class="sd">    :param theta: tuple or list containing each parameter</span>
<span class="sd">    :param obs: list or array containing the observed flux of each data point</span>
<span class="sd">    :param times: list or array containing the times at which each data point is recorded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># unpack parameters</span>
    <span class="n">f_like</span><span class="p">,</span> <span class="n">df_like</span><span class="p">,</span> <span class="n">p_like</span><span class="p">,</span> <span class="n">tt_like</span><span class="p">,</span> <span class="n">off_like</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="c1"># expected value</span>
    <span class="n">lmbda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">transit</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">f_like</span><span class="p">,</span> <span class="n">df_like</span><span class="p">,</span> <span class="n">p_like</span><span class="p">,</span> <span class="n">tt_like</span><span class="p">,</span> <span class="n">off</span><span class="o">=</span><span class="n">off_like</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lmbda</span><span class="p">))</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</code></pre></div>


<p>When using MCMC, the log posterior can be found as the sum of the log prior and log likelihood:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">logposterior</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="n">logprior</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="c1"># check log prior is finite</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lprior</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lprior</span> <span class="o">+</span> <span class="n">loglike</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">logposterior_square</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="n">logprior_square</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="c1"># check log prior is finite</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lprior</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lprior</span> <span class="o">+</span> <span class="n">loglike_square</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</code></pre></div>


<p>Next, we can start setting up the MCMC model. To start, I'll draw 200 <a href="https://en.wikipedia.org/wiki/Statistical_ensemble_(mathematical_physics)">"ensemble"</a> samples from each prior distribution, which will be used to represent the priors. I'll also define 500 "burn-in" iterations to allow the chain to converge, and 500 further iterations to produce the posteriors.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># no. ensemble points</span>
<span class="n">Nens</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">inisamples</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">priors</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inisamples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">Nens</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inisamples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">Nens</span><span class="p">))</span>
<span class="n">inisamples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">inisamples</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">inisamples_square</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">priors_square</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inisamples_square</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">Nens</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inisamples_square</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">Nens</span><span class="p">))</span>
<span class="n">inisamples_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">inisamples_square</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">ndims</span> <span class="o">=</span> <span class="n">inisamples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ndims_square</span> <span class="o">=</span> <span class="n">inisamples_square</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># no. iterations</span>
<span class="n">Nburn</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">Nsamples</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">loglike</span><span class="o">.</span><span class="n">ncalls</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">loglike_square</span><span class="o">.</span><span class="n">ncalls</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>


<p>Now that everything is set up, we can perform the sampling process:</p>
<div class="codehilite"><pre><span></span><code><span class="n">sampler</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">Nens</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">logposterior</span><span class="p">)</span>
<span class="n">sampler_square</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">Nens</span><span class="p">,</span> <span class="n">ndims_square</span><span class="p">,</span> <span class="n">logposterior_square</span><span class="p">)</span>

<span class="c1"># perform sampling</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">inisamples</span><span class="p">,</span> <span class="n">Nsamples</span><span class="o">+</span><span class="n">Nburn</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time taken to sample a trapezium transit model with emcee: </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
<span class="n">sampler_square</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">inisamples_square</span><span class="p">,</span> <span class="n">Nsamples</span><span class="o">+</span><span class="n">Nburn</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time taken to sample a square transit model with emcee: </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">time taken to sample a trapezium transit model with emcee: 22.782975673675537 seconds</span>
<span class="err">time taken to sample a square transit model with emcee: 19.97200083732605 seconds</span>
</code></pre></div>


<p>The burn-in points can be removed before collecting the chains as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="n">samples_trapez</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">chain</span><span class="p">[:,</span> <span class="n">Nburn</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndims</span><span class="p">))</span>
<span class="n">samples_square</span> <span class="o">=</span> <span class="n">sampler_square</span><span class="o">.</span><span class="n">chain</span><span class="p">[:,</span> <span class="n">Nburn</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndims_square</span><span class="p">))</span>
</code></pre></div>


<h3 id="results">Results</h3>
<p>Let's take a look at what we found. Looking at the trapezium model, we can plot the posteriors of each parameter, along with contour plots describing how one parameter may vary with any other. This can be done using "corner.py", and a scipy Gaussian KDE function.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">plotposts</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">hist_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">axidx</span><span class="p">,</span> <span class="n">samps</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">samples</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">samps</span><span class="p">)</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axidx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xvals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axidx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">kde</span><span class="p">(</span><span class="n">xvals</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="s1">&#39;dFlux&#39;</span><span class="p">,</span> <span class="s1">&#39;Period&#39;</span><span class="p">,</span> <span class="s1">&#39;Transit Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Transit Flat Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Offset&#39;</span><span class="p">]</span>
<span class="n">plotposts</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</code></pre></div>


<p><img alt="png" src="../output_36_0.png" /></p>
<p>For each model, we can find the mean and standard deviation of each parameter using the traces. For the trapezium transit model:</p>
<div class="codehilite"><pre><span></span><code><span class="n">f</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span><span class="p">,</span> <span class="n">dferr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p</span><span class="p">,</span> <span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">tt</span><span class="p">,</span> <span class="n">tterr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">tf</span><span class="p">,</span> <span class="n">tferr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">off</span><span class="p">,</span> <span class="n">offerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">5</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters describing a trapezium shaped transit model: </span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
      <span class="s2">&quot;       unobstructed flux = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> e-/s </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ferr</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;fractional flux decrease = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">dferr</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot;                  period = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">perr</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;      total transit time = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">tterr</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot;       flat transit time = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span><span class="n">tferr</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;                  offset = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">off</span><span class="p">,</span><span class="n">offerr</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="k">Parameters</span> <span class="n">describing</span> <span class="n">a</span> <span class="n">trapezium</span> <span class="n">shaped</span> <span class="n">transit</span> <span class="n">model</span><span class="p">:</span>

       <span class="n">unobstructed</span> <span class="n">flux</span> <span class="o">=</span> <span class="mi">541508</span><span class="p">.</span><span class="mi">1852844431</span> <span class="err"></span> <span class="mi">36</span><span class="p">.</span><span class="mi">9344420907229</span> <span class="n">e</span><span class="o">-/</span><span class="n">s</span> 
<span class="n">fractional</span> <span class="n">flux</span> <span class="n">decrease</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">00024461083692660444</span> <span class="err"></span> <span class="mi">3</span><span class="p">.</span><span class="mi">7035342916871527</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span> 
                  <span class="k">period</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8370801841354675</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">008002462715920132</span> <span class="n">days</span> 
      <span class="n">total</span> <span class="n">transit</span> <span class="k">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">14446313515960185</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">010012520942390852</span> <span class="n">days</span> 
       <span class="n">flat</span> <span class="n">transit</span> <span class="k">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">14221868661500203</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">010486564635702324</span> <span class="n">days</span> 
                  <span class="k">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1501856219851231</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">000792190343252601</span> <span class="n">days</span>
</code></pre></div>


<p>The same can be done for the square transit model:</p>
<div class="codehilite"><pre><span></span><code><span class="n">f_square</span><span class="p">,</span> <span class="n">ferr_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                               <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_square</span><span class="p">,</span> <span class="n">dferr_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                                 <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p_square</span><span class="p">,</span> <span class="n">perr_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">tt_square</span><span class="p">,</span> <span class="n">tterr_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">off_square</span><span class="p">,</span> <span class="n">offerr_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">4</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters describing a square shaped transit model: </span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
      <span class="s2">&quot;       unobstructed flux = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> e-/s </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f_square</span><span class="p">,</span><span class="n">ferr_square</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;fractional flux decrease = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_square</span><span class="p">,</span><span class="n">dferr_square</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot;                  period = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_square</span><span class="p">,</span><span class="n">perr_square</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;      total transit time = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tt_square</span><span class="p">,</span><span class="n">tterr_square</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot;                  offset = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">off_square</span><span class="p">,</span><span class="n">offerr_square</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="k">Parameters</span> <span class="n">describing</span> <span class="n">a</span> <span class="n">square</span> <span class="n">shaped</span> <span class="n">transit</span> <span class="n">model</span><span class="p">:</span>

       <span class="n">unobstructed</span> <span class="n">flux</span> <span class="o">=</span> <span class="mi">541509</span><span class="p">.</span><span class="mi">5710077788</span> <span class="err"></span> <span class="mi">38</span><span class="p">.</span><span class="mi">29278598182498</span> <span class="n">e</span><span class="o">-/</span><span class="n">s</span> 
<span class="n">fractional</span> <span class="n">flux</span> <span class="n">decrease</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">00024373683466889182</span> <span class="err"></span> <span class="mi">3</span><span class="p">.</span><span class="mi">7647641082140636</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span> 
                  <span class="k">period</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8372673158389097</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">008000578546054328</span> <span class="n">days</span> 
      <span class="n">total</span> <span class="n">transit</span> <span class="k">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">14409081829513087</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">010074301386211069</span> <span class="n">days</span> 
                  <span class="k">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1501740077644908</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">00081315394152917</span> <span class="n">days</span>
</code></pre></div>


<p>The period in both cases is around 20 hours. This is unique to one body in the Kepler-10 system: Our model describes the transits of Kepler-10b.</p>
<h3 id="plotting-the-posterior">Plotting the posterior</h3>
<p>We can sample from the posteriors further to create slightly different sets of the parameters. From this, we can plot a new line over our original data, creating a posterior predictive plot. The regions in which the model is most likely to fall in will appear darker on the plot, and so the darker the plot, the higher the probabillity of the flux passing through it.</p>
<p>Start by randomly choosing 400 of each parameter for the trapezium and square models:</p>
<div class="codehilite"><pre><span></span><code><span class="n">n_fits</span> <span class="o">=</span> <span class="mi">400</span>

<span class="n">fsamps_trap_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">dfsamps_trap_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">psamps_trap_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">ttsamps_trap_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">tfsamps_trap_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">offsamps_trap_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trapez</span><span class="p">[:,</span><span class="mi">5</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>

<span class="n">fsamps_square_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">dfsamps_square_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">psamps_square_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">ttsamps_square_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
<span class="n">offsamps_square_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_square</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">n_fits</span><span class="p">)</span>
</code></pre></div>


<p>Below are two plots of the results of the MCMC algorithm. The first shows the entire original light curve data set, with a model with mean parameters plotted on top. The second shows a "zoomed in" view of a few exoplanet transits, with the posterior predictive overplotted. </p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># mean plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">tt</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="n">off</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>

<span class="c1"># posterior predictive plot</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fits</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dfsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">psamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ttsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tfsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">offsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time / days&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">541300</span><span class="p">,</span> <span class="mi">541600</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">545</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;A light curve from Kepler-10 with overplotted&quot;</span> <span class="o">+</span>
             <span class="s2">&quot; mean trapezium transit model (top) and posterior predictive plot (bottom)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_46_0.png" /></p>
<p>The same process can be repeated for the square transit model:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># mean plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f_square</span><span class="p">,</span><span class="n">df_square</span><span class="p">,</span><span class="n">p_square</span><span class="p">,</span><span class="n">tt_square</span><span class="p">,</span><span class="n">off</span><span class="o">=</span><span class="n">off_square</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>

<span class="c1"># posterior predictive plot</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fits</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fsamps_square_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dfsamps_square_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">psamps_square_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
             <span class="n">ttsamps_square_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">off</span><span class="o">=</span><span class="n">offsamps_square_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time / days&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">541300</span><span class="p">,</span> <span class="mi">541600</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">545</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;A light curve from Kepler-10 with overplotted&quot;</span> <span class="o">+</span>
             <span class="s2">&quot; mean square transit model (top) and posterior predictive plot (bottom)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_48_0.png" /></p>
<p>From the posterior predictive plots, it seems that both models explain the data fairly well. The trapezium model seems like it follows the data a little closer, but I won't dismiss the square transit model just yet. To decide which model best describes the data, we can see which best predicts properties of the Kepler-10 system.</p>
<h3 id="model-comparisons">Model comparisons</h3>
<p>Now that we have the mean values for each parameter, we can start to infer information about the star-planet system the model describes. I'll use both models for this, and find out which model predicts the properties the system with the greatest accuracy. For the derivations on equations for the following calculations, check out <a href="https://arxiv.org/pdf/1711.06601.pdf">this paper</a>. For each property, I'll state the most accpeted values found <a href="https://en.wikipedia.org/wiki/Kepler-10">here</a>.</p>
<p>The first property we can find is the ratio of the planet radius "Rp" and star radius "Rs". This is simply the square root of the mean flux drop:</p>
<div class="codehilite"><pre><span></span><code><span class="n">RpRs</span><span class="p">,</span> <span class="n">RpRs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">dferr</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">RpRs_square</span><span class="p">,</span> <span class="n">RpRs_square_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df_square</span><span class="p">),</span> <span class="n">dferr_square</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df_square</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Planet to star radius ratio (trapezium transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RpRs</span><span class="p">,</span> <span class="n">RpRs_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Planet to star radius ratio (square transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
       <span class="n">RpRs_square</span><span class="p">,</span> <span class="n">RpRs_square_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accepted planet to star radius ratio: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0127</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">Planet to star radius ratio (trapezium transit model): 0.01564003954363941  0.00023679826904231388</span>
<span class="err">Planet to star radius ratio (square transit model): 0.015612073362269722  0.00024114440285122598</span>
<span class="err">Accepted planet to star radius ratio: 0.0127</span>
</code></pre></div>


<p>Both models are in close agreement with each other, and are quite close to the accepted value of the planet to star radius ratio (to within the same order of magnitude). We only used a handful of transits, and under one month of data, so the difference between predicted and accepted ratios here are acceptable. Sampling with the entire dataset instead of the shortened data I used does not improve this estimate.</p>
<p>Next, we can attempt to find incination angle "I", usually defined as the angle between the plane of a celestial body's orbit and the plane that is normal to the line of sight from Earth. This isn't quite possible for the square model, due to the total transit and flat transit times being equal. To account for this, I'll instead say the flat transit time is 99% of the total transit time, just to keep everything finite.</p>
<div class="codehilite"><pre><span></span><code><span class="n">tf_square</span><span class="p">,</span> <span class="n">tferr_square</span> <span class="o">=</span> <span class="mf">0.99</span><span class="o">*</span><span class="n">tt_square</span><span class="p">,</span> <span class="mf">0.99</span><span class="o">*</span><span class="n">tterr_square</span>
</code></pre></div>


<p>The calculations become pretty complex here, and error propagation becomes difficult. Instead, I'll approximate the errors, as we're mostly interested in the relative errors between the two models anyway. To begin, we start by approximating the semi-minor axis "b", and the normalised semi-major axis "aRs" as below: </p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">semiminor</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">tt</span><span class="p">,</span><span class="n">tf</span><span class="p">):</span>
    <span class="c1"># return semi-minor axis, given model parameters</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span><span class="n">tt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">tf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">tt</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">tf</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">normsemimajor</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">tt</span><span class="p">,</span><span class="n">tf</span><span class="p">):</span>
    <span class="c1"># return normalised semi-major axis, given model parameters</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tt</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">tf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

<span class="c1"># semiminor for trapezium model</span>
<span class="n">b_trap</span> <span class="o">=</span> <span class="n">semiminor</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
<span class="n">b_trap_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">semiminor</span><span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="n">dferr</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span> <span class="o">-</span> <span class="n">b_trap</span><span class="p">)</span>

<span class="c1"># semiminor for square model</span>
<span class="n">b_square</span> <span class="o">=</span> <span class="n">semiminor</span><span class="p">(</span><span class="n">df_square</span><span class="p">,</span> <span class="n">tt_square</span><span class="p">,</span> <span class="n">tf_square</span><span class="p">)</span>
<span class="n">b_square_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">semiminor</span><span class="p">(</span><span class="n">df_square</span> <span class="o">+</span> <span class="n">dferr_square</span><span class="p">,</span> <span class="n">tt_square</span><span class="p">,</span> <span class="n">tf_square</span><span class="p">)</span> <span class="o">-</span> <span class="n">b_square</span><span class="p">)</span>

<span class="c1"># semimajor for trapezium model</span>
<span class="n">aRs_trap</span> <span class="o">=</span> <span class="n">normsemimajor</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
<span class="n">aRs_trap_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">normsemimajor</span><span class="p">(</span><span class="n">df</span><span class="o">+</span><span class="n">dferr</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="n">perr</span><span class="p">,</span><span class="n">tt</span><span class="o">+</span><span class="n">tterr</span><span class="p">,</span><span class="n">tf</span><span class="o">+</span><span class="n">tferr</span><span class="p">)</span> <span class="o">-</span> <span class="n">aRs_trap</span><span class="p">)</span>

<span class="c1"># semimajor for square model</span>
<span class="n">aRs_square</span> <span class="o">=</span> <span class="n">normsemimajor</span><span class="p">(</span><span class="n">df_square</span><span class="p">,</span> <span class="n">p_square</span><span class="p">,</span> <span class="n">tt_square</span><span class="p">,</span> <span class="n">tf_square</span><span class="p">)</span>
<span class="n">aRs_square_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">normsemimajor</span><span class="p">(</span><span class="n">df_square</span><span class="o">+</span><span class="n">dferr_square</span><span class="p">,</span><span class="n">p_square</span><span class="o">+</span><span class="n">perr_square</span><span class="p">,</span>
                               <span class="n">tt_square</span><span class="o">+</span><span class="n">tterr_square</span><span class="p">,</span><span class="n">tf_square</span><span class="o">+</span><span class="n">tferr_square</span><span class="p">)</span> <span class="o">-</span> <span class="n">aRs_square</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalised semi-major axis (trapezium transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aRs_trap</span><span class="p">,</span>
                                                                                  <span class="n">aRs_trap_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalised semi-major axis (square transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aRs_square</span><span class="p">,</span>
                                                                               <span class="n">aRs_square_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accepted normalised semi-major axis: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">3.40</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">Normalised semi-major axis (trapezium transit model): 3.11343439016216  0.24897493968215692</span>
<span class="err">Normalised semi-major axis (square transit model): 3.38730776154764  0.11671862724332449</span>
<span class="err">Accepted normalised semi-major axis: 3.4</span>
</code></pre></div>


<p>The ratio of semi-minor axis to normalised semi-major axis gives the cosine of the inclination angle of Kepler-10b. Therefore, the predictions of the inclination from both models are as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="n">I_trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">b_trap</span><span class="o">/</span><span class="n">aRs_trap</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">I_trap_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="n">b_trap</span><span class="o">+</span><span class="n">b_trap_err</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aRs_trap</span><span class="o">-</span><span class="n">aRs_trap_err</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">I_trap</span><span class="p">)</span>

<span class="n">I_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">b_square</span><span class="o">/</span><span class="n">aRs_square</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">I_square_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="n">b_square</span><span class="o">+</span><span class="n">b_square_err</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aRs_square</span><span class="o">-</span><span class="n">aRs_square_err</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">I_square</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inclination angle (trapezium transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> degrees&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I_trap</span><span class="p">,</span><span class="n">I_trap_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inclination angle (square transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> degrees&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I_square</span><span class="p">,</span><span class="n">I_square_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accepted inclination angle: </span><span class="si">{}</span><span class="s2"> degrees&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">84.4</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">Inclination angle (trapezium transit model): 81.68965145311803  0.9307232291459115 degrees</span>
<span class="err">Inclination angle (square transit model): 83.21823835267094  0.5963780613143967 degrees</span>
<span class="err">Accepted inclination angle: 84.4 degrees</span>
</code></pre></div>


<p>An inclination of 90 degrees means that the planet orbits parallel to the line of sight from Earth. Again, both models make a decent attempt estimating the inclination, however the square transit shape is a little more accurate, and has a smaller uncertainty. This might suggest the square transit model might actually be a little better for this data.</p>
<p>Finally, we can attempt to predict the density of the star, Kepler-10. This makes the assumption that the radius of the star is much bigger than the radius of the planet. Since we measured the ratio of planet to star radii to be around 0.015, this assumption is pretty reasonable.</p>
<p>The star density can be calculated using the semi-major and semi-minor axes, along with some other parameters from the models:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">star_density</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">tt</span><span class="p">,</span><span class="n">aRs</span><span class="p">):</span>
    <span class="c1"># return density of star given model parameters</span>
    <span class="n">G</span> <span class="o">=</span> <span class="mf">6.67408e-11</span>
    <span class="n">wt</span> <span class="o">=</span> <span class="n">tt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span>
    <span class="c1"># transform p from days to seconds</span>
    <span class="n">p</span> <span class="o">*=</span> <span class="mi">86400</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">aRs</span><span class="o">**</span><span class="mi">3</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

<span class="c1"># star density predicted by trapezium model</span>
<span class="n">stard_trap</span> <span class="o">=</span> <span class="n">star_density</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">tt</span><span class="p">,</span><span class="n">aRs_trap</span><span class="p">)</span>
<span class="n">stard_trap_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">star_density</span><span class="p">(</span><span class="n">df</span><span class="o">+</span><span class="n">dferr</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="n">perr</span><span class="p">,</span><span class="n">tt</span><span class="o">-</span><span class="n">tterr</span><span class="p">,</span><span class="n">aRs_trap</span><span class="o">+</span><span class="n">aRs_trap_err</span><span class="p">)</span> <span class="o">-</span> <span class="n">stard_trap</span><span class="p">)</span>

<span class="c1"># star density predicted by square model</span>
<span class="n">stard_square</span> <span class="o">=</span> <span class="n">star_density</span><span class="p">(</span><span class="n">df_square</span><span class="p">,</span><span class="n">p_square</span><span class="p">,</span><span class="n">tt_square</span><span class="p">,</span><span class="n">aRs_square</span><span class="p">)</span>
<span class="n">stard_square_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">star_density</span><span class="p">(</span><span class="n">df_square</span><span class="o">+</span><span class="n">dferr_square</span><span class="p">,</span><span class="n">p_square</span><span class="o">-</span><span class="n">perr_square</span><span class="p">,</span><span class="n">tt_square</span><span class="o">-</span><span class="n">tterr_square</span><span class="p">,</span>
                                    <span class="n">aRs_square</span><span class="o">+</span><span class="n">aRs_square_err</span><span class="p">)</span> <span class="o">-</span> <span class="n">stard_square</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Star density (trapezium transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> kg/m</span><span class="se">\u00b3</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stard_trap</span><span class="p">,</span>
                                                                               <span class="n">stard_trap_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Star density (square transit model): </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> kg/m</span><span class="se">\u00b3</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stard_square</span><span class="p">,</span>
                                                                            <span class="n">stard_square_err</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True star density: </span><span class="si">{}</span><span class="s2"> kg/m</span><span class="se">\u00b3</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1070</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">Star density (trapezium transit model): 964.774196469593  100.61863106968042 kg/m</span>
<span class="err">Star density (square transit model): 1048.78853195487  79.23816897368705 kg/m</span>
<span class="err">True star density: 1070 kg/m</span>
</code></pre></div>


<p>This shows that not only does a square transit shape predict the density of the star remarkably well, it also has a slightly lower fractional uncertainty on it's estimate compared to the trapezium shaped transit. A reason for this may be that Kepler-10 is around the same size as the Sun, and Kepler-10b is actually larger than Earth, yet the planet is only infront of its star for only 3 hours. This means the planet has to be travelling fast, resulting in very steep slopes on the trapezium transit light curve. It seems involving the extra "tf" parameter only serves to complicate the model and add uncertainty when using a square wave is just as good, as is proven above.</p>
<h2 id="modelling-with-ultranest">Modelling with UltraNest</h2>
<p>If we want a more definitive way of determining which model better desribes the observed data, we'll need to find the Bayes factor, which requires the marginalised likelihoods for the trapezium and square transit shapes. We can do this using the "UltraNest" nested sampling package.</p>
<h3 id="sampling-the-data_1">Sampling the data</h3>
<p>This works in a simillar way to emcee, in fact we can use the same likelihood functions defined earlier, however we do have to create a new prior function. UltraNest samples from a unit hypercube parameter space, and so the prior function must transform the parameters back into their true space. The two functions below show how this is done using scipy's inverse error function "ndtri":</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">prior_transform</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms parameters from a unit hypercube space to their true space </span>
<span class="sd">    for a trapezium transit model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># uniform transform for f</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># normal transform for remaining parameters</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ndtri</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prior_transform_square</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms parameters from a unit hypercube space to their true space</span>
<span class="sd">    for a square transit model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># uniform transform for f</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span><span class="o">*</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># normal transform for remaining parameters</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">priors_square</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ndtri</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>


<p>We can now create a model for both the trapezium and square transit shapes. Since there are up to 6 parameters in a model, the UltraNest sampler may struggle to perform. To solve this, use a slice sampler as is shown below: </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># initialise samplers</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">([</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;df&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;tt&#39;</span><span class="p">,</span><span class="s1">&#39;tf&#39;</span><span class="p">,</span><span class="s1">&#39;off&#39;</span><span class="p">],</span>
                                          <span class="n">loglike</span><span class="p">,</span> <span class="n">prior_transform</span><span class="p">)</span>
<span class="n">sampler_square</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">([</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;df&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;tt&#39;</span><span class="p">,</span><span class="s1">&#39;off&#39;</span><span class="p">],</span>
                                          <span class="n">loglike_square</span><span class="p">,</span> <span class="n">prior_transform_square</span><span class="p">)</span>

<span class="c1"># use &quot;slice&quot; sampler, due to high dimensionality</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">priors</span><span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">stepsampler</span> <span class="o">=</span> <span class="n">stepsampler</span><span class="o">.</span><span class="n">RegionSliceSampler</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="n">nsteps</span><span class="p">)</span>
<span class="n">sampler_square</span><span class="o">.</span><span class="n">stepsampler</span> <span class="o">=</span> <span class="n">stepsampler</span><span class="o">.</span><span class="n">RegionSliceSampler</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="n">nsteps</span><span class="p">)</span>

<span class="c1"># define live points and stopping criterion</span>
<span class="n">nlive</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">stop</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># run the samplers</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
<span class="n">results_trap</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="n">nlive</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
<span class="n">results_square</span> <span class="o">=</span> <span class="n">sampler_square</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="n">nlive</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>
      <span class="s1">&#39;Time taken to sample trapezium shaped model with UltraNest: </span><span class="si">{}</span><span class="s1"> seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time taken to sample square shaped model with UltraNest: </span><span class="si">{}</span><span class="s1"> seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w"> </span><span class="n">Sampling</span><span class="w"> </span><span class="mi">400</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">prior</span><span class="w"> </span><span class="p">...</span><span class="w"></span>



<span class="n">VBox</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="k">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">GridspecLayout</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="k">value</span><span class="o">=</span><span class="ss">&quot;&lt;div style=&#39;background-color:#6E6BF4;&#39;&gt;&amp;nb</span>


<span class="ss">[ultranest] Explored until L=-3e+02  .17 [-273.5034..-273.5033]*| it/evals=2795/188281 eff=1.4876% N=400 </span>
<span class="ss">[ultranest] Likelihood function evaluations: 188565</span>
<span class="ss">[ultranest]   logZ = -275.8 +- 0.0255</span>
<span class="ss">[ultranest] Effective samples strategy satisfied (ESS = 2007.1, need &gt;400)</span>
<span class="ss">[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.46+-0.06 nat, need &lt;0.50 nat)</span>
<span class="ss">[ultranest] Evidency uncertainty strategy is satisfied (dlogz=0.07, need &lt;0.5)</span>
<span class="ss">[ultranest]   logZ error budget: single: 0.04 bs:0.03 tail:0.01 total:0.03 required:&lt;0.50</span>
<span class="ss">[ultranest] done iterating.</span>
<span class="ss">[ultranest] Sampling 400 live points from prior ...</span>



<span class="ss">VBox(children=(HTML(value=&#39;&#39;), GridspecLayout(children=(HTML(value=&quot;</span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;background-color:#6E6BF4;&#39;</span><span class="o">&gt;&amp;</span><span class="n">nb</span><span class="err"></span><span class="w"></span>


<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w"> </span><span class="n">Explored</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">L</span><span class="o">=-</span><span class="mf">3e+02</span><span class="w">  </span><span class="mf">.21</span><span class="w"> </span><span class="o">[</span><span class="n">-273.4930..-273.4929</span><span class="o">]*|</span><span class="w"> </span><span class="n">it</span><span class="o">/</span><span class="n">evals</span><span class="o">=</span><span class="mi">2798</span><span class="o">/</span><span class="mi">184875</span><span class="w"> </span><span class="n">eff</span><span class="o">=</span><span class="mf">1.5167</span><span class="o">%</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mi">400</span><span class="w"> </span>
<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w"> </span><span class="n">Likelihood</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="nl">evaluations</span><span class="p">:</span><span class="w"> </span><span class="mi">184875</span><span class="w"></span>
<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w">   </span><span class="n">logZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">275.8</span><span class="w"> </span><span class="o">+-</span><span class="w"> </span><span class="mf">0.03241</span><span class="w"></span>
<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w"> </span><span class="n">Effective</span><span class="w"> </span><span class="n">samples</span><span class="w"> </span><span class="n">strategy</span><span class="w"> </span><span class="n">satisfied</span><span class="w"> </span><span class="p">(</span><span class="n">ESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2008.9</span><span class="p">,</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">400</span><span class="p">)</span><span class="w"></span>
<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w"> </span><span class="n">Posterior</span><span class="w"> </span><span class="n">uncertainty</span><span class="w"> </span><span class="n">strategy</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">satisfied</span><span class="w"> </span><span class="p">(</span><span class="nl">KL</span><span class="p">:</span><span class="w"> </span><span class="mf">0.45</span><span class="o">+-</span><span class="mf">0.11</span><span class="w"> </span><span class="n">nat</span><span class="p">,</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.50</span><span class="w"> </span><span class="n">nat</span><span class="p">)</span><span class="w"></span>
<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w"> </span><span class="n">Evidency</span><span class="w"> </span><span class="n">uncertainty</span><span class="w"> </span><span class="n">strategy</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">satisfied</span><span class="w"> </span><span class="p">(</span><span class="n">dlogz</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">)</span><span class="w"></span>
<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w">   </span><span class="n">logZ</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="nl">budget</span><span class="p">:</span><span class="w"> </span><span class="nl">single</span><span class="p">:</span><span class="w"> </span><span class="mf">0.04</span><span class="w"> </span><span class="nl">bs</span><span class="p">:</span><span class="mf">0.03</span><span class="w"> </span><span class="nl">tail</span><span class="p">:</span><span class="mf">0.01</span><span class="w"> </span><span class="nl">total</span><span class="p">:</span><span class="mf">0.03</span><span class="w"> </span><span class="nl">required</span><span class="p">:</span><span class="o">&lt;</span><span class="mf">0.50</span><span class="w"></span>
<span class="o">[</span><span class="n">ultranest</span><span class="o">]</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="n">iterating</span><span class="p">.</span><span class="w"></span>


<span class="nc">Time</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="n">trapezium</span><span class="w"> </span><span class="n">shaped</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nl">UltraNest</span><span class="p">:</span><span class="w"> </span><span class="mf">45.595500469207764</span><span class="w"> </span><span class="n">seconds</span><span class="w"></span>
<span class="nc">Time</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="nf">square</span><span class="w"> </span><span class="n">shaped</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nl">UltraNest</span><span class="p">:</span><span class="w"> </span><span class="mf">40.1266610622406</span><span class="w"> </span><span class="n">seconds</span><span class="w"></span>
</code></pre></div>


<h3 id="results_1">Results</h3>
<p>To retrieve the traces from a nested sampler, you must resample according the some weights which are produced during the sampling. I'll only do this for the trapezium model for now, just to keep the code from getting too cluttered:</p>
<div class="codehilite"><pre><span></span><code><span class="n">samples_points_trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results_trap</span><span class="p">[</span><span class="s2">&quot;weighted_samples&quot;</span><span class="p">][</span><span class="s2">&quot;points&quot;</span><span class="p">])</span>
<span class="n">weights_trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results_trap</span><span class="p">[</span><span class="s2">&quot;weighted_samples&quot;</span><span class="p">][</span><span class="s2">&quot;weights&quot;</span><span class="p">])</span>

<span class="n">resample_trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights_trap</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">weights_trap</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">weights_trap</span><span class="p">)</span>

<span class="n">samples_trap_ultra</span> <span class="o">=</span> <span class="n">samples_points_trap</span><span class="p">[</span><span class="n">resample_trap</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div>


<p>The mean parameter values and their errors can be found easily:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># parameter means and errors for trapezium transit</span>
<span class="n">f_trap_ultra</span><span class="p">,</span> <span class="n">ferr_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                                       <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_trap_ultra</span><span class="p">,</span> <span class="n">dferr_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                                         <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p_trap_ultra</span><span class="p">,</span> <span class="n">perr_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                                       <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">tt_trap_ultra</span><span class="p">,</span> <span class="n">tterr_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                                         <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">tf_trap_ultra</span><span class="p">,</span> <span class="n">tferr_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
                                         <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">off_trap_ultra</span><span class="p">,</span> <span class="n">offerr_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>
                                           <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">5</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters describing a trapezium shaped transit model from UltraNest: </span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
      <span class="s2">&quot;       unobstructed flux = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> e-/s </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f_trap_ultra</span><span class="p">,</span><span class="n">ferr_trap_ultra</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;fractional flux decrease = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_trap_ultra</span><span class="p">,</span><span class="n">dferr_trap_ultra</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot;                  period = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_trap_ultra</span><span class="p">,</span><span class="n">perr_trap_ultra</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;      total transit time = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tt_trap_ultra</span><span class="p">,</span><span class="n">tterr_trap_ultra</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot;       flat transit time = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf_trap_ultra</span><span class="p">,</span><span class="n">tferr_trap_ultra</span><span class="p">)</span> <span class="o">+</span> 
      <span class="s2">&quot;                  offset = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> days </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">off_trap_ultra</span><span class="p">,</span><span class="n">offerr_trap_ultra</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="k">Parameters</span> <span class="n">describing</span> <span class="n">a</span> <span class="n">trapezium</span> <span class="n">shaped</span> <span class="n">transit</span> <span class="n">model</span> <span class="k">from</span> <span class="n">UltraNest</span><span class="p">:</span>

       <span class="n">unobstructed</span> <span class="n">flux</span> <span class="o">=</span> <span class="mi">541506</span><span class="p">.</span><span class="mi">0367278325</span> <span class="err"></span> <span class="mi">38</span><span class="p">.</span><span class="mi">07219702378676</span> <span class="n">e</span><span class="o">-/</span><span class="n">s</span> 
<span class="n">fractional</span> <span class="n">flux</span> <span class="n">decrease</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0002456676060063817</span> <span class="err"></span> <span class="mi">3</span><span class="p">.</span><span class="mi">5643330145173593</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span> 
                  <span class="k">period</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8376992378349714</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">007805962818414923</span> <span class="n">days</span> 
      <span class="n">total</span> <span class="n">transit</span> <span class="k">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">14467439301959553</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">010237468121439578</span> <span class="n">days</span> 
       <span class="n">flat</span> <span class="n">transit</span> <span class="k">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">14315067160042744</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">009933449672703609</span> <span class="n">days</span> 
                  <span class="k">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">15020443219136784</span> <span class="err"></span> <span class="mi">0</span><span class="p">.</span><span class="mi">0008319592417544441</span> <span class="n">days</span>
</code></pre></div>


<h3 id="plotting-the-posterior_1">Plotting the posterior</h3>
<p>We can make the same posterior plots as with emcee, for the sake of comparison. The samples for the posterior predictive plot can be collected as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="n">nfits</span> <span class="o">=</span> <span class="mi">400</span>

<span class="c1"># samples for trapezium transit posterior predictive plot</span>
<span class="n">fsamps_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span>
<span class="n">dfsamps_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span>
<span class="n">psamps_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span>
<span class="n">ttsamps_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span>
<span class="n">tfsamps_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span>
<span class="n">offsamps_trap_ultra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_trap_ultra</span><span class="p">[:,</span><span class="mi">5</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span>
</code></pre></div>


<p>Below are three plots. The first two plots show the mean posterior plot and the posteroir predictive plot respectively, produced by UltraNest. The third shows the posterior predictive plot from UltraNest, with the posterior predictive plot from emcee overplotted:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># mean plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f_trap_ultra</span><span class="p">,</span><span class="n">df_trap_ultra</span><span class="p">,</span><span class="n">p_trap_ultra</span><span class="p">,</span>
            <span class="n">tt_trap_ultra</span><span class="p">,</span><span class="n">tf_trap_ultra</span><span class="p">,</span><span class="n">off_trap_ultra</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;UltraNest mean posterior plot&quot;</span><span class="p">)</span>

<span class="c1"># posterior predictive plot</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fits</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dfsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">psamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ttsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tfsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">offsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;k:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux / e-/s&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;UltraNest posterior predictive plot&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">541300</span><span class="p">,</span> <span class="mi">541600</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">545</span><span class="p">)</span>

<span class="c1"># emcee and UltraNest overlapping posterior predictive plot</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fits</span><span class="p">):</span>
    <span class="n">y_ultra</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dfsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">psamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ttsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tfsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">offsamps_trap_ultra</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">y_emcee</span> <span class="o">=</span> <span class="n">transit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dfsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">psamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ttsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tfsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">offsamps_trap_emcee</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_ultra</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.008</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;UltraNest&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_emcee</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.008</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;emcee&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux / e-/s&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / days&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;emcee (red) and UltraNest (blue) overlayed posterior predictive plots&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">541300</span><span class="p">,</span> <span class="mi">541600</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">545</span><span class="p">)</span>

<span class="n">leg</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lh</span> <span class="ow">in</span> <span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">:</span> 
    <span class="n">lh</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;A light curve from Kepler-10 with overplotted&#39;</span> <span class="o">+</span>
             <span class="s1">&#39; mean trapezium transit model (top) and posterior predictive plot (bottom)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_78_0.png" /></p>
<h3 id="model-comparisons_1">Model comparisons</h3>
<p>Instead of going through all the same inclination angle and star density calculations, I'll instead use the logs of the marginalised likelihoods to compare the models. These can be easily collected from the sampler results: </p>
<div class="codehilite"><pre><span></span><code><span class="n">logZ_trap</span><span class="p">,</span> <span class="n">logZerr_trap</span> <span class="o">=</span> <span class="n">results_trap</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">],</span> <span class="n">results_trap</span><span class="p">[</span><span class="s1">&#39;logzerr&#39;</span><span class="p">]</span>        
<span class="n">logZ_square</span><span class="p">,</span> <span class="n">logZerr_square</span> <span class="o">=</span> <span class="n">results_square</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">],</span> <span class="n">results_square</span><span class="p">[</span><span class="s1">&#39;logzerr&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Marginalised likelihood for trapezium transit model: </span><span class="si">{}</span><span class="s2">  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logZ_trap</span><span class="p">,</span> <span class="n">logZerr_trap</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Marginalised likelihood for square transit model: </span><span class="si">{}</span><span class="s2">  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logZ_square</span><span class="p">,</span> <span class="n">logZerr_square</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">Marginalised likelihood for trapezium transit model: -275.82725389875935  0.03821787065493758</span>
<span class="err">Marginalised likelihood for square transit model: -275.8168531966252  0.06290063669114569</span>
</code></pre></div>


<p>Using these marginal likelihoods, we can find the Bayes factor. This is the defined as the ratio of the marginal likelihoods. If the Bayes factor is larger than one, it means that the trapezium model is more likely to produce the observed data.</p>
<div class="codehilite"><pre><span></span><code><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_trap</span> <span class="o">-</span> <span class="n">logZ_square</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bayes factor: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="err">Bayes factor: 0.9896531981395177</span>
</code></pre></div>


<p>This result tells us that the square transit model is only slightly more likely to produce the observed light curve, as we first predicted earlier with emcee.</p>
<p>In reality, the transit model makes a lot more sense than a square transit shape. However, since there were only around 4 or 5 data points per transit, their shape was likely misrepresented. If instead we used a data set of a planet with a longer transit time, or took flux measurements more frequently, then the trapezium transit shape may become prefered.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../PyMC3_GRS/PyMC3_GRS/" title="Gamma-Ray Spectroscopy with PyMC3 and dynesty" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Gamma-Ray Spectroscopy with PyMC3 and dynesty
              </div>
            </div>
          </a>
        
        
          <a href="../../Sunspots2/Sunspots2/" title="Solar Cycle Analysis with Zeus and Nestle" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Solar Cycle Analysis with Zeus and Nestle
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.92ffa368.min.js"></script>
      <script src="../../assets/javascripts/bundle.5123e3d4.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
      
    
  </body>
</html>