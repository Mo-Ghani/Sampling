


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.0">
    
    
      
        <title>Solar Cycle Analysis with Zeus and Nestle - Demonstrations of MCMC and Nested Samplers in Physics</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.b5d04df8.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-zeus-and-nestle-to-model-the-sunspot-cycles" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Demonstrations of MCMC and Nested Samplers in Physics" class="md-header-nav__button md-logo" aria-label="Demonstrations of MCMC and Nested Samplers in Physics">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Demonstrations of MCMC and Nested Samplers in Physics
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Solar Cycle Analysis with Zeus and Nestle
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Demonstrations of MCMC and Nested Samplers in Physics" class="md-nav__button md-logo" aria-label="Demonstrations of MCMC and Nested Samplers in Physics">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Demonstrations of MCMC and Nested Samplers in Physics
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../PyMC3_GRS/PyMC3_GRS/" title="Gamma-Ray Spectroscopy with PyMC3 and dynesty" class="md-nav__link">
      Gamma-Ray Spectroscopy with PyMC3 and dynesty
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LightCurve/LightCurve/" title="Exoplanet Light Curve Analysis with emcee and UltraNest" class="md-nav__link">
      Exoplanet Light Curve Analysis with emcee and UltraNest
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Solar Cycle Analysis with Zeus and Nestle
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Solar Cycle Analysis with Zeus and Nestle" class="md-nav__link md-nav__link--active">
      Solar Cycle Analysis with Zeus and Nestle
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#useful-imports" class="md-nav__link">
    Useful imports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viewing-the-data" class="md-nav__link">
    Viewing the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-model" class="md-nav__link">
    The model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-zeus" class="md-nav__link">
    Modelling with Zeus
  </a>
  
    <nav class="md-nav" aria-label="Modelling with Zeus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predicting-the-next-solar-cycles" class="md-nav__link">
    Predicting the next solar cycles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prediction-results" class="md-nav__link">
    Prediction results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-nestle" class="md-nav__link">
    Modelling with Nestle
  </a>
  
    <nav class="md-nav" aria-label="Modelling with Nestle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data_1" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results_1" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior_1" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../gravwaves/gravwaves/" title="Gravitational Wave Parameter Estimation with bilby" class="md-nav__link">
      Gravitational Wave Parameter Estimation with bilby
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../particleID/particleID/" title="Particle Identification in Proton-Proton Collisions with PyStan and DNest4" class="md-nav__link">
      Particle Identification in Proton-Proton Collisions with PyStan and DNest4
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../TheOnlineMCMC/TheOnlineMCMC/" title="Zero Installation Sampling with The Online MCMC" class="md-nav__link">
      Zero Installation Sampling with The Online MCMC
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#useful-imports" class="md-nav__link">
    Useful imports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viewing-the-data" class="md-nav__link">
    Viewing the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-model" class="md-nav__link">
    The model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-zeus" class="md-nav__link">
    Modelling with Zeus
  </a>
  
    <nav class="md-nav" aria-label="Modelling with Zeus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predicting-the-next-solar-cycles" class="md-nav__link">
    Predicting the next solar cycles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prediction-results" class="md-nav__link">
    Prediction results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling-with-nestle" class="md-nav__link">
    Modelling with Nestle
  </a>
  
    <nav class="md-nav" aria-label="Modelling with Nestle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-data_1" class="md-nav__link">
    Sampling the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#results_1" class="md-nav__link">
    Results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plotting-the-posterior_1" class="md-nav__link">
    Plotting the posterior
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="using-zeus-and-nestle-to-model-the-sunspot-cycles">Using Zeus and Nestle to model the sunspot cycles</h1>
<p>A sunspot is an area on the surface of the Sun that appears a lot darker than its surroundings, caused by intense magnetic fields regulating a convection effect on the Sun's surface. Humanity has been tracking the average number of sunspots visible from Earth on the solar disk, and found that the sunspot number follows a <a href="https://en.wikipedia.org/wiki/Solar_cycle">cycle</a> over roughly 11 years. </p>
<p>In this example, I'll use the "Zeus" and "Nestle" samplers to fit a model describing the sunspot number to a single solar cycle. I'll then use this model to create a new model which predicts the properties of a solar cycle, given the properties of the previous cycle.</p>
<h2 id="useful-imports">Useful imports</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># numpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># scipy</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">ndtri</span><span class="p">,</span> <span class="n">gammaln</span>

<span class="c1"># Plotting</span>
<span class="kn">import</span> <span class="nn">corner</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1"># Samplers</span>
<span class="kn">import</span> <span class="nn">zeus</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Zeus version: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zeus</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">nestle</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nestle version: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nestle</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>

<span class="c1"># misc</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>Zeus version: 1.0.7
Nestle version: 0.2.0
</code></pre></div>

<h2 id="viewing-the-data">Viewing the data</h2>
<p>Using Pandas, we can load the .csv file containing the average sunspot number over 24 solar cycles, since the 1750s. First I will plot the entire dataset to decide which cycles are of interest, however before plotting I'll first take the square root of the sunspot number. This is just to decrease the variance in the peak height, which will make everything a little easier when it comes to making a model that can predict the height of the next peak.</p>
<div class="codehilite"><pre><span></span><code><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;SN_m_tot_V2.0.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">80</span><span class="p">:]</span>
<span class="n">ssn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="mi">3</span><span class="p">])[</span><span class="mi">80</span><span class="p">:]</span>
<span class="n">sqrtssn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ssn</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">sqrtssn</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Average sunspot number from 1750-2020&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_6_0.png" /></p>
<p>I chose to look at the 4 solar cycles starting around the year 1924, as there seems to be a consistent (predictable!) change from peak to peak. Next, we need to take a closer look at those 4 solar cycles so that we can create a model.</p>
<div class="codehilite"><pre><span></span><code><span class="n">start</span> <span class="o">=</span> <span class="mi">2020</span>      <span class="c1"># data point corresponding to the start of the 1924 solar cycle</span>
<span class="n">period</span> <span class="o">=</span> <span class="mi">123</span>      <span class="c1"># average width of a solar cycle</span>

<span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># plot region of interest</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">period</span><span class="p">],</span><span class="n">sqrtssn</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">period</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Average sunspot number from 1924-1965&quot;</span><span class="p">)</span>

<span class="c1"># fragment the 4 solar cycles into 4 separate lists</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">sqrtssn</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">period</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">period</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">peaktimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">period</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">period</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

<span class="c1"># plot a typical solar cycle</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;A typical solar cycle&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_8_0.png" /></p>
<h2 id="the-model">The model</h2>
<p>We can create the model by splitting it into two parts: the ascending region, and the descending region. To define these regions, we need to know when the cycle begins, when the cycle peaks, and when the cycle ends. We'll call these "t0", "tmax", and "t1" respectively. Next, we need to know the amplitude of the peak, which we will call "c". Finally, we need 2 more parameters which will describe how much the ascending and descending regions curve, which we will call "a1", and  "a2".</p>
<p>Using all of these, we can define our model for a single solar cycle below:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">cycle</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">t1</span><span class="p">):</span>

    <span class="c1"># a1,a2 &gt; 1</span>
    <span class="k">if</span> <span class="n">a1</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">a2</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1">#t0 &lt; tmax &lt; t1</span>
    <span class="k">if</span> <span class="n">t0</span> <span class="o">&gt;=</span> <span class="n">tmax</span><span class="p">:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">tmax</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">t1</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">tmax</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># sunspot number as a function of time</span>
    <span class="n">ssn</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="n">tmax</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tmax</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span><span class="o">**</span><span class="n">a1</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">tmax</span>
           <span class="k">else</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">tmax</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">tmax</span><span class="p">))</span><span class="o">**</span><span class="n">a2</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">]</span>

    <span class="c1"># ssn &gt; 0</span>
    <span class="n">ssn_non_negative</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ssn</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">ssn_non_negative</span>
</code></pre></div>


<p>I'll take the first solar cycle (starting 1924), and use some guesses for each parameter to overplot a model, just to give an idea of what the model will look like.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># plot cycle data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Data&quot;</span><span class="p">)</span>
<span class="c1"># plot an example model, with guessed parameters</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="mf">1.3</span><span class="p">,</span><span class="mf">1923.5</span><span class="p">,</span><span class="mf">1927.5</span><span class="p">,</span><span class="mi">1935</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Example Model&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;A typical solar cycle, with an </span><span class="se">\n</span><span class="s2"> example model overplotted&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_13_0.png" /></p>
<h2 id="modelling-with-zeus">Modelling with Zeus</h2>
<p>Zeus has a very similar interface to the sampler "emcee", which uses an ensemble technique to obtain the prior distributions. The next step is defining the prior distributions for each parameter. I'll use a normal distribution for the peak amplitude "c", since it's pretty easy to eyeball. Aside from that, I'll be using uniform priors for every other parameter as they're a little trickier to guess.</p>
<div class="codehilite"><pre><span></span><code><span class="n">nens</span> <span class="o">=</span> <span class="mi">100</span>     <span class="c1"># number of ensemble points</span>
<span class="n">ndims</span> <span class="o">=</span> <span class="mi">6</span>      <span class="c1"># number of parameters</span>

<span class="c1"># mean and standard deviation of normal parameter priors</span>
<span class="n">cmu</span><span class="p">,</span><span class="n">csig</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span><span class="mi">1</span>
<span class="c1"># lower and upper bounds of uniform parameter priors</span>
<span class="n">a1min</span><span class="p">,</span><span class="n">a1max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<span class="n">a2min</span><span class="p">,</span><span class="n">a2max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<span class="n">t0min</span><span class="p">,</span><span class="n">t0max</span> <span class="o">=</span> <span class="mi">1922</span><span class="p">,</span><span class="mi">1925</span>
<span class="n">tmaxmin</span><span class="p">,</span><span class="n">tmaxmax</span> <span class="o">=</span> <span class="mi">1926</span><span class="p">,</span><span class="mi">1929</span>
<span class="n">t1min</span><span class="p">,</span><span class="n">t1max</span> <span class="o">=</span> <span class="mi">1933</span><span class="p">,</span><span class="mi">1936</span>

<span class="n">param_priors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># normal prior on c</span>
<span class="n">param_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">cmu</span><span class="p">,</span><span class="n">csig</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on a1</span>
<span class="n">param_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a1min</span><span class="p">,</span><span class="n">a1max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on a2</span>
<span class="n">param_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a2min</span><span class="p">,</span><span class="n">a2max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on t0</span>
<span class="n">param_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t0min</span><span class="p">,</span><span class="n">t0max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on tmax</span>
<span class="n">param_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">tmaxmin</span><span class="p">,</span><span class="n">tmaxmax</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on t1</span>
<span class="n">param_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t1min</span><span class="p">,</span><span class="n">t1max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>

<span class="n">param_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param_priors</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>


<p>Next, we need to define a log prior, log likelihood, and log posterior. The log prior can be defined as below:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">logprior</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log of the prior, given set of current parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_priors</span><span class="p">)):</span>
        <span class="c1"># sum log priors from each parameter</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># normal priors</span>
            <span class="n">lprior</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cmu</span><span class="p">)</span> <span class="o">/</span> <span class="n">csig</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># uniform priors</span>

            <span class="c1"># set bounds</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">a1min</span><span class="p">,</span> <span class="n">a1max</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">a2min</span><span class="p">,</span> <span class="n">a2max</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">t0min</span><span class="p">,</span><span class="n">t0max</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">tmaxmin</span><span class="p">,</span><span class="n">tmaxmax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">t1min</span><span class="p">,</span><span class="n">t1max</span>

            <span class="c1"># parameter must be between bounds</span>
            <span class="k">if</span>  <span class="n">low</span> <span class="o">&lt;</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">up</span><span class="p">:</span> 
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lprior</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">return</span> <span class="n">lprior</span>
</code></pre></div>


<p>The log likelihood takes the form of a Poisson likelihood, since the sunspot counts are non-negative. using "lmbda" as the expected value of the cycle function, we can define the likelihood as below:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log likelihood, given the current parameters, dates, and sunspot counts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># unpack parameters</span>
    <span class="n">c_like</span><span class="p">,</span> <span class="n">a1_like</span><span class="p">,</span> <span class="n">a2_like</span><span class="p">,</span> <span class="n">t0_like</span><span class="p">,</span> <span class="n">tmax_like</span><span class="p">,</span> <span class="n">t1_like</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="c1"># expected value</span>
    <span class="n">lmbda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cycle</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">c_like</span><span class="p">,</span> <span class="n">a1_like</span><span class="p">,</span> <span class="n">a2_like</span><span class="p">,</span> <span class="n">t0_like</span><span class="p">,</span> <span class="n">tmax_like</span><span class="p">,</span> <span class="n">t1_like</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lmbda</span><span class="p">))</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</code></pre></div>


<p>Finally the log posterior is simply the sum of the log prior log likelihood:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">logposterior</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log posterior, given the log prior and log likelihood</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="n">logprior</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="c1"># check log prior is finite</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lprior</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lprior</span> <span class="o">+</span> <span class="n">loglike</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</code></pre></div>


<h3 id="sampling-the-data">Sampling the data</h3>
<p>Now that we've defined everything we need, we can easily run the sampling process with Zeus.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># create sampler using the first peak</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">zeus</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="n">nens</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">logposterior</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">nburn</span> <span class="o">=</span> <span class="mi">500</span>       <span class="c1"># burn-in points</span>
<span class="n">nsamples</span> <span class="o">=</span> <span class="mi">500</span>    <span class="c1"># points after burn-in</span>

<span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">param_samples</span><span class="p">,</span> <span class="n">nburn</span> <span class="o">+</span> <span class="n">nsamples</span><span class="p">)</span>
<span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time taken to sample first peak with Zeus: </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time1</span><span class="o">-</span><span class="n">time0</span><span class="p">))</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>Initialising ensemble of 100 walkers...
Sampling progress : 100%|██████████| 1000/1000 [01:16&lt;00:00, 13.13it/s]

Time taken to sample first peak with Zeus: 76.26689600944519 seconds
</code></pre></div>

<h3 id="results">Results</h3>
<p>Collecting the samples after the sampling is equally simple, remembering to discard the burn-in samples at the start of the chain. We can create a corner plot using <a href="https://corner.readthedocs.io/en/latest/">"corner.py"</a>, which shows the posteriors of each parameter along with contour plots describing how one parameter varies with any other:</p>
<div class="codehilite"><pre><span></span><code><span class="n">samples_zeus</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">discard</span><span class="o">=</span><span class="n">nburn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plotposts</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">hist_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">axidx</span><span class="p">,</span> <span class="n">samps</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">samples</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">samps</span><span class="p">)</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axidx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xvals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axidx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">kde</span><span class="p">(</span><span class="n">xvals</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a1&#39;</span><span class="p">,</span> <span class="s1">&#39;a2&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;tmax&#39;</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">]</span>
<span class="n">plotposts</span><span class="p">(</span><span class="n">samples_zeus</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</code></pre></div>


<p><img alt="png" src="../output_28_0.png" /></p>
<p>The posterior for the "a2" parameter looks as though it peaks below a value of 1, which is outside the prior range. However, the model will not have the correct shape if "a1" is less than 1, which suggests that the choice of model may be limiting the quality of the fit.</p>
<p>Next, I'll find the means and standard deviation error on each parameter. I'll also choose random samples from the chains of each parameter, which I'll use to visualise the posteriors.</p>
<div class="codehilite"><pre><span></span><code><span class="n">param_mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_zeus</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
<span class="n">param_sig</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_zeus</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>

<span class="n">nfits</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">param_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_zeus</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
<span class="n">post_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param_samples</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters describing the square root SSN cycle starting 1923: </span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;   c = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> square root counts</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> 
      <span class="s2">&quot;  a1 = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param_sig</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span>
      <span class="s2">&quot;  a2 = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param_sig</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span>
      <span class="s2">&quot;  t0 = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> years</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">param_sig</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span>
      <span class="s2">&quot;tmax = </span><span class="si">{}</span><span class="s2">  </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> years</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">param_sig</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span>
      <span class="s2">&quot;  t1 = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> years</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">param_sig</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>Parameters describing the square root SSN cycle starting 1923:

   c = 11.23419227189279 ± 0.5155512374811139 square root counts
  a1 = 2.046091218734536 ± 0.5511917043187438 
  a2 = 1.3175512464689283 ± 0.2551941095539496 
  t0 = 1923.4364606185572 ± 0.3683613113062203 years
tmax = 1927.5745437571138  ± 0.6532168763478214 years
  t1 = 1935.0535923941627 ± 0.30717761056370796 years
</code></pre></div>

<h3 id="plotting-the-posterior">Plotting the posterior</h3>
<p>Below I'll show two plots. The left plot will show the model produced using the mean parameters for the first peak. The right plot will show a posterior predictive plot, where the darker the colour of the plot, the higher the probability of the model passing through that region.</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># mean posterior plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">param_mu</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;square root counts&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean posterior plot for solar cycle starting 1924&quot;</span><span class="p">)</span>

<span class="c1"># posterior predictive plot</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Origina Data&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post_samples</span><span class="p">)):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">post_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fitted Model&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Posterior predictive plot for SSN cycle starting 1924&quot;</span><span class="p">)</span>
<span class="n">leg</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="k">for</span> <span class="n">lh</span> <span class="ow">in</span> <span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">:</span> 
    <span class="n">lh</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_33_0.png" /></p>
<h3 id="predicting-the-next-solar-cycles">Predicting the next solar cycles</h3>
<p>We now know the properties of the solar cycle between 1924-1934. Next, we want to know the properties of the next three cycles in our region of interest. We could just redefine our prior distributions, and run the sampling again for each peak. Alternatively, we could create a new model which takes the current solar cycle parameters, and uses them to predict the next solar cycle. This model will only realistically be able to make long-range predictions if the solar cycles evolve consistently, as mentioned above.</p>
<p>This way this model is put together is quite complicated. More details can be found <a href="https://wwwf.imperial.ac.uk/~dvandyk/Research/15-bayes.trend-solar.pdf">here</a>, but the brief is that we need 3 scaling parameters (y1,y2,y3), and 4 translation parameters (d0,d1,d2,d3). This model can be implemented as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">predict_cycle</span><span class="p">(</span><span class="n">theta_prev</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">):</span>
    <span class="c1"># theta_prev contains the set of parameters describing the previous solar cycle</span>
    <span class="n">c_prev</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">t0_prev</span><span class="p">,</span> <span class="n">tmax_prev</span><span class="p">,</span> <span class="n">t1_prev</span> <span class="o">=</span> <span class="n">theta_prev</span>
    <span class="c1"># start of cycle found using slight deviation d0</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">t1_prev</span> <span class="o">+</span> <span class="n">d0</span>
    <span class="c1"># current c found using current t0 and previous c,tmax</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">y1</span><span class="o">*</span><span class="n">c_prev</span><span class="o">/</span><span class="p">(</span><span class="n">t0</span> <span class="o">-</span> <span class="n">tmax_prev</span><span class="p">)</span> <span class="o">+</span> <span class="n">d1</span>
    <span class="c1"># current tmax found using current t0,c</span>
    <span class="c1"># t0-param_mu[4] describes the time since 1924 solar cycle</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">y2</span><span class="o">*</span><span class="n">c</span> <span class="o">+</span> <span class="n">d2</span><span class="o">*</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">**</span><span class="mf">0.9</span>
    <span class="c1"># current t1 found using current tmax,c</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">tmax</span> <span class="o">+</span> <span class="n">y3</span><span class="o">*</span><span class="n">c</span> <span class="o">+</span> <span class="n">d3</span><span class="o">*</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="n">param_mu</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">**</span><span class="mf">0.3</span>
    <span class="c1">#a1,a2 unchanged</span>
    <span class="c1"># return new set of parameters</span>
    <span class="n">theta_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">tmax</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">theta_new</span>
</code></pre></div>


<p>We can now try to guess the scaling and translational parameters, and using the set of parameters defining the first solar cycle, we can try to predict the second solar cycle between 1934-1944. I'll show this by plotting the data for the second solar cycle, and overplotting the predicted model. After some trial and error, I found the following prediction:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># predict the next peak parameters, using current peak parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">7.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># plot second solar cycle</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Data&quot;</span><span class="p">)</span>
<span class="c1"># overplot predicted model with new parameters</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">params</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Average square root sunspot number between 1934-1944 </span><span class="se">\n</span><span class="s2"> with overplotted predicted model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_38_0.png" /></p>
<p>Using the above guesses, we can define some prior distributions. This is done in exactly the same way as above, however due to some hard limits on the parameters (such as a1,a2 being strictly greater than 1), I'll use uniform priors for all parameters.</p>
<div class="codehilite"><pre><span></span><code><span class="n">nens</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">ndims</span> <span class="o">=</span> <span class="mi">7</span>

<span class="n">d0min</span><span class="p">,</span><span class="n">d0max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span><span class="mi">0</span>
<span class="n">d1min</span><span class="p">,</span><span class="n">d1max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span>
<span class="n">d2min</span><span class="p">,</span><span class="n">d2max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span>
<span class="n">d3min</span><span class="p">,</span><span class="n">d3max</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span><span class="mf">0.4</span>
<span class="n">y1min</span><span class="p">,</span><span class="n">y1max</span> <span class="o">=</span> <span class="mf">7.</span><span class="p">,</span><span class="mf">8.</span>
<span class="n">y2min</span><span class="p">,</span><span class="n">y2max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span>
<span class="n">y3min</span><span class="p">,</span><span class="n">y3max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span>

<span class="n">predict_priors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># uniform prior on d0</span>
<span class="n">predict_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">d0min</span><span class="p">,</span><span class="n">d0max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on d1</span>
<span class="n">predict_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">d1min</span><span class="p">,</span><span class="n">d1max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on d2</span>
<span class="n">predict_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">d2min</span><span class="p">,</span><span class="n">d2max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on d3</span>
<span class="n">predict_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">d3min</span><span class="p">,</span><span class="n">d3max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on y1</span>
<span class="n">predict_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y1min</span><span class="p">,</span><span class="n">y1max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on y2</span>
<span class="n">predict_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y2min</span><span class="p">,</span><span class="n">y2max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>
<span class="c1"># uniform prior on y3</span>
<span class="n">predict_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y3min</span><span class="p">,</span><span class="n">y3max</span><span class="p">,</span><span class="n">nens</span><span class="p">))</span>

<span class="n">priors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">d0min</span><span class="p">,</span><span class="n">d0max</span><span class="p">),(</span><span class="n">d1min</span><span class="p">,</span><span class="n">d1max</span><span class="p">),(</span><span class="n">d2min</span><span class="p">,</span><span class="n">d2max</span><span class="p">),(</span><span class="n">d3min</span><span class="p">,</span><span class="n">d3max</span><span class="p">),</span>
          <span class="p">(</span><span class="n">y1min</span><span class="p">,</span><span class="n">y1max</span><span class="p">),(</span><span class="n">y2min</span><span class="p">,</span><span class="n">y2max</span><span class="p">),(</span><span class="n">y3min</span><span class="p">,</span><span class="n">y3max</span><span class="p">)]</span>
<span class="n">predict_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predict_priors</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>


<p>We need to create new log prior, log likelihood, and log posterior functions. This is done almost exactly as above, but with very slight variations, so I'll won't go into detail about the machinery in these functions.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">loglike_predict</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log likelihood, given the current parameters, dates, and sunspot counts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># expected value found by predicting new parameters, and then mimicking old likelihood function</span>
    <span class="n">params_new</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span> <span class="o">*</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">lmbda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cycle</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="o">*</span><span class="n">params_new</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lmbda</span><span class="p">))</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">logprior_predict</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log of the prior, given set of current parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_priors</span><span class="p">)):</span>
        <span class="c1"># sum log priors from each parameter</span>
        <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>            
        <span class="c1"># uniform prior for time parameters</span>
        <span class="k">if</span>  <span class="n">low</span> <span class="o">&lt;</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">up</span><span class="p">:</span> 
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lprior</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">return</span> <span class="n">lprior</span>

<span class="k">def</span> <span class="nf">logposterior_predict</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log posterior, given the log prior and log likelihood</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lprior</span> <span class="o">=</span> <span class="n">logprior_predict</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="c1"># check log prior is finite</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lprior</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lprior</span> <span class="o">+</span> <span class="n">loglike_predict</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</code></pre></div>


<p>Running the sampler, using the same burn-in and chain lengths as above, we can tune the parameters so they predict the parameters of the second solar cycle well. We'll then assume that these parameters are the same for the third and fourth peaks, and see how good the quality of the fit is with increasing forecast time.</p>
<div class="codehilite"><pre><span></span><code><span class="n">sampler</span> <span class="o">=</span> <span class="n">zeus</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="n">nens</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">logposterior_predict</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">nburn</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">nsamples</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">predict_samples</span><span class="p">,</span> <span class="n">nburn</span> <span class="o">+</span> <span class="n">nsamples</span><span class="p">)</span>
<span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time taken to sample predict function with Zeus: </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time1</span><span class="o">-</span><span class="n">time0</span><span class="p">))</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>Initialising ensemble of 100 walkers...
Sampling progress : 100%|██████████| 1000/1000 [01:19&lt;00:00, 12.56it/s]

Time taken to sample predict function with Zeus: 79.66238069534302 seconds
</code></pre></div>

<h3 id="prediction-results">Prediction results</h3>
<p>Out of curiosity, we can check the corner plot for the prediction model. Since the prediction model has every parameter interacting with each other, we can expect a load of covariance between parameters.</p>
<div class="codehilite"><pre><span></span><code><span class="n">samples_zeus2</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">discard</span><span class="o">=</span><span class="n">nburn</span><span class="p">)</span>

<span class="n">predict_param_mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_zeus2</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="n">predict_param_sig</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_zeus2</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>

<span class="n">nfits</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">predict_param_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_zeus2</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="n">predict_post_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predict_param_samples</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;d0&#39;</span><span class="p">,</span><span class="s1">&#39;d1&#39;</span><span class="p">,</span><span class="s1">&#39;d2&#39;</span><span class="p">,</span><span class="s1">&#39;d3&#39;</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span> <span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="s1">&#39;y3&#39;</span><span class="p">]</span>
<span class="n">plotposts</span><span class="p">(</span><span class="n">samples_zeus2</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>
</code></pre></div>


<p><img alt="png" src="../output_47_0.png" /></p>
<p>Lets check what predictions we can now make. The below code takes the set of parameters describing the first solar cycle, and uses it to predict the second solar cycle. The prediction will be plotted over the data, and then the program will move on to the next peak and repeat the process. Since we're making predictions on using predictions, over and over, we can expect the fit to get worse as we look deeper into the future.</p>
<p>I'll also use the samples from the prediction model posteriors, and create a posterior predictive plot for each cycle. This should show the quality of the prediction, and how it evolves with increasing forecast time.</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># predict second peak parameters</span>
<span class="c1"># plot mean posterior plot</span>
<span class="n">new_param_mu</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">*</span><span class="n">predict_param_mu</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">new_param_mu</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Average sunspot number for the solar cycles</span><span class="se">\n</span><span class="s2"> between 1933-1965&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot; with overfitted</span><span class="se">\n</span><span class="s2"> mean predicted models&quot;</span><span class="p">)</span>
<span class="c1"># posterior predictive plot</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">new_pred</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_post_samples</span><span class="p">)):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">*</span><span class="n">predict_post_samples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">new_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Average sunspot number for the solar cycles</span><span class="se">\n</span><span class="s2"> between 1933-1965&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot; with overfitted</span><span class="se">\n</span><span class="s2"> posterior predictive plots&quot;</span><span class="p">)</span>


<span class="c1"># predict third peak parameters </span>
<span class="c1"># plot mean posterior plot</span>
<span class="n">new_param_mu</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">new_param_mu</span><span class="p">,</span> <span class="o">*</span><span class="n">predict_param_mu</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">new_param_mu</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="c1"># posterior predictive plot</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">new_pred2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_post_samples</span><span class="p">)):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">new_pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">predict_param_mu</span><span class="p">)</span>
    <span class="n">new_pred2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># predict fourth peak parameters</span>
<span class="c1"># plot mean posterior plot</span>
<span class="n">new_param_mu</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">new_param_mu</span><span class="p">,</span> <span class="o">*</span><span class="n">predict_param_mu</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Data&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">new_param_mu</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted Model&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># posterior predictive plot</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_post_samples</span><span class="p">)):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">new_pred2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">predict_param_mu</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_49_0.png" /></p>
<p>Saying that our prediction model was fairly simplified, it actually does a pretty good job at predicting the solar cycle shape. The posterior plots show the predictions getting worse over time as expected, but even so the accuracy on the mean plots are within 20% for the majority of the cycles.</p>
<h2 id="modelling-with-nestle">Modelling with Nestle</h2>
<p>The predictions from this model only work if we know in advance that the next solar cycle will carry on the trend from the previous solar cycle. Since in reality it is very hard to say how the Sun will behave in advance, this model won't be all that useful.</p>
<p>However, it did save us from having to individually sampling 3 solar cycles. To decide whether or not the time save is worth the loss in accuracy, I'll use "Nestle" to sample both the second solar cycle (between 1934-1945), and the prediction model for that same solar cycle. Nestle uses nested sampling, and so it produces a value of the marginalised evidence. Comparing these values will allow us to see how much accuracy we're sacrificing by predicting the solar cycle, instead of just sampling the next peak.</p>
<h3 id="sampling-the-data_1">Sampling the data</h3>
<p>To start, we'll assume that Zeus did a good enough job at sampling the first solar cycle, and jump straight to the second cycle (1934-1945). Lets define some new guesses for each parameter (c,a1,a2,t0,tmax,t1):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># mean and standard deviation of normal parameter priors</span>
<span class="n">cmu</span><span class="p">,</span><span class="n">csig</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span><span class="mi">1</span>
<span class="c1"># lower and upper bounds of uniform parameter priors</span>
<span class="n">a1min</span><span class="p">,</span><span class="n">a1max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<span class="n">a2min</span><span class="p">,</span><span class="n">a2max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<span class="n">t0min</span><span class="p">,</span><span class="n">t0max</span> <span class="o">=</span> <span class="mi">1931</span><span class="p">,</span><span class="mi">1935</span>
<span class="n">tmaxmin</span><span class="p">,</span><span class="n">tmaxmax</span> <span class="o">=</span> <span class="mi">1936</span><span class="p">,</span><span class="mi">1940</span>
<span class="n">t1min</span><span class="p">,</span><span class="n">t1max</span> <span class="o">=</span> <span class="mi">1943</span><span class="p">,</span><span class="mi">1947</span>

<span class="n">param_priors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">cmu</span><span class="p">,</span><span class="n">csig</span><span class="p">),(</span><span class="n">a1min</span><span class="p">,</span><span class="n">a1max</span><span class="p">),(</span><span class="n">a2min</span><span class="p">,</span><span class="n">a2max</span><span class="p">),</span>
                <span class="p">(</span><span class="n">t0min</span><span class="p">,</span><span class="n">t0max</span><span class="p">),(</span><span class="n">tmaxmin</span><span class="p">,</span><span class="n">tmaxmax</span><span class="p">),(</span><span class="n">t1min</span><span class="p">,</span><span class="n">t1max</span><span class="p">)]</span>
</code></pre></div>


<p>We can reuse most of the stuff we had from before, except for the log prior functions. Nestle samples from a unit hypercube parameter space, so we need a function that transforms the priors back to their original space. This only requires a slight modification to our previous "logprior" function, making use of scipy's ndtri function. </p>
<p>I'll also make a very minor change to the log likelihood function. Instead of taking the dates and sunspot counts as arguments, it will use the data for the second solar cycle by default.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">prior_transform</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to transform the parameters from unit hypercube to their true form</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trans_params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># transform normal prior</span>
    <span class="n">trans_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_priors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">param_priors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ndtri</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># transform uniform prior</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span> <span class="o">=</span> <span class="n">param_priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">param_priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">trans_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">maxi</span><span class="o">-</span><span class="n">mini</span><span class="p">)</span> <span class="o">+</span> <span class="n">mini</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">trans_params</span>

<span class="k">def</span> <span class="nf">loglike_nestle</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log likelihood, with data fixed for solar cycle between 1934-1945</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
    <span class="c1"># unpack parameters</span>
    <span class="n">c_like</span><span class="p">,</span> <span class="n">a1_like</span><span class="p">,</span> <span class="n">a2_like</span><span class="p">,</span> <span class="n">t0_like</span><span class="p">,</span> <span class="n">tmax_like</span><span class="p">,</span> <span class="n">t1_like</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="c1"># expected value</span>
    <span class="n">lmbda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cycle</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">c_like</span><span class="p">,</span> <span class="n">a1_like</span><span class="p">,</span> <span class="n">a2_like</span><span class="p">,</span> <span class="n">t0_like</span><span class="p">,</span> <span class="n">tmax_like</span><span class="p">,</span> <span class="n">t1_like</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lmbda</span><span class="p">))</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</code></pre></div>


<p>We're now ready to run the sampling using Nestle:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># set number of dimensions, live points, sampling method, and stopping criterion</span>
<span class="n">ndims</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">nlive</span> <span class="o">=</span> <span class="mi">1024</span>     
<span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;multi&#39;</span>        
<span class="n">stop</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">results_sample</span> <span class="o">=</span> <span class="n">nestle</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">loglike_nestle</span><span class="p">,</span> <span class="n">prior_transform</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">npoints</span><span class="o">=</span><span class="n">nlive</span><span class="p">,</span> <span class="n">dlogz</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
<span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time taken to sample second solar cycle with Nestle: </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time1</span><span class="o">-</span><span class="n">time0</span><span class="p">))</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>Time taken to sample second solar cycle with Nestle: 18.891968965530396 seconds
</code></pre></div>

<p>We'll now try the sampling again, but this time we'll use the parameters from the first solar cycle (found using Zeus), and sample the parameters of the prediction model. Start by guessing at the parameters for the prediction model:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># reuse our guesses from Zeus</span>
<span class="n">d0min</span><span class="p">,</span><span class="n">d0max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span><span class="mi">0</span>
<span class="n">d1min</span><span class="p">,</span><span class="n">d1max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span>
<span class="n">d2min</span><span class="p">,</span><span class="n">d2max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span>
<span class="n">d3min</span><span class="p">,</span><span class="n">d3max</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span><span class="mf">0.4</span>
<span class="n">y1min</span><span class="p">,</span><span class="n">y1max</span> <span class="o">=</span> <span class="mf">7.</span><span class="p">,</span><span class="mf">8.</span>
<span class="n">y2min</span><span class="p">,</span><span class="n">y2max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span>
<span class="n">y3min</span><span class="p">,</span><span class="n">y3max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span>

<span class="n">predict_priors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">d0min</span><span class="p">,</span><span class="n">d0max</span><span class="p">),(</span><span class="n">d1min</span><span class="p">,</span><span class="n">d1max</span><span class="p">),(</span><span class="n">d2min</span><span class="p">,</span><span class="n">d2max</span><span class="p">),(</span><span class="n">d3min</span><span class="p">,</span><span class="n">d3max</span><span class="p">),</span>
               <span class="p">(</span><span class="n">y1min</span><span class="p">,</span><span class="n">y1max</span><span class="p">),(</span><span class="n">y2min</span><span class="p">,</span><span class="n">y2max</span><span class="p">),(</span><span class="n">y3min</span><span class="p">,</span><span class="n">y3max</span><span class="p">)]</span>
</code></pre></div>


<p>We have to tinker with out prediction model's likelihood and prior functions to suit the prediction model. This is done exactly as it was previously with Zeus.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">loglike_nestle_predict</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log likelihood, given the current parameters, dates, and sunspot counts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span><span class="p">,</span><span class="n">times</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># expected value found by predicting new parameters, and then mimicking old likelihood function</span>
    <span class="n">params_new</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span> <span class="o">*</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">lmbda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cycle</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="o">*</span><span class="n">params_new</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lmbda</span><span class="p">))</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">prior_transform_predict</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to return the log of the prior, given set of current parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trans_priors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_priors</span><span class="p">)):</span>
        <span class="c1"># sum log priors from each parameter</span>
        <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span> <span class="o">=</span> <span class="n">predict_priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">predict_priors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>            
        <span class="c1"># uniform prior for time parameters</span>
        <span class="n">trans_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">maxi</span><span class="o">-</span><span class="n">mini</span><span class="p">)</span><span class="o">+</span><span class="n">mini</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">trans_priors</span>
</code></pre></div>


<p>Now that everything is set up, I'll run through the same sampling process, using the same hyper-parameters for fairness.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># set number of dimensions, live points, sampling method, and stopping criterion</span>
<span class="n">ndims</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">nlive</span> <span class="o">=</span> <span class="mi">1024</span>     
<span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;multi&#39;</span>        
<span class="n">stop</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">results_predict</span> <span class="o">=</span> <span class="n">nestle</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">loglike_nestle_predict</span><span class="p">,</span> <span class="n">prior_transform_predict</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">npoints</span><span class="o">=</span><span class="n">nlive</span><span class="p">,</span> <span class="n">dlogz</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
<span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time taken to sample prediction model with Nestle: </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time1</span><span class="o">-</span><span class="n">time0</span><span class="p">))</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>Time taken to sample prediction model with Nestle: 13.779999017715454 seconds
</code></pre></div>

<h3 id="results_1">Results</h3>
<p>Next, we find the log of the marginalised evidence provided by Nestle. This can be done as follows, using the information gain to estimate the error:</p>
<div class="codehilite"><pre><span></span><code><span class="n">logZ_sample</span> <span class="o">=</span> <span class="n">results_sample</span><span class="o">.</span><span class="n">logz</span>
<span class="n">logZerr_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">results_sample</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">nlive</span><span class="p">)</span> 

<span class="n">logZ_predict</span> <span class="o">=</span> <span class="n">results_predict</span><span class="o">.</span><span class="n">logz</span>
<span class="n">logZerr_predict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">results_predict</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">nlive</span><span class="p">)</span> 

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;log(Z) from sampling the solar cycle = </span><span class="si">{}</span><span class="s2"> ± </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logZ_sample</span><span class="p">,</span> <span class="n">logZerr_sample</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;log(Z) from predicting the solar cycle = </span><span class="si">{}</span><span class="s2"> ± </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logZ_predict</span><span class="p">,</span> <span class="n">logZerr_predict</span><span class="p">))</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>log(Z) from sampling the solar cycle = -266.75746256813557 ± 0.07494693736170717
log(Z) from predicting the solar cycle = -266.81473144676227 ± 0.07314472974917986
</code></pre></div>

<p>The Bayes factor is a metric that describes how much more likely a model is to produce an observed data set. It's defined as the ratios between the marginalised evidences of the two models:</p>
<div class="codehilite"><pre><span></span><code><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_predict</span> <span class="o">-</span> <span class="n">logZ_sample</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bayes factor: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
</code></pre></div>


<div class="highlight"><pre><span></span><code>Bayes factor: 0.9443401223523545
</code></pre></div>

<p>This tells us that sampling via the prediction method rather than just sampling the peak doesn't come at much of a cost to the quality of the model. Since the methods produce similar results, lets collect the samples from the prediction method to use for visualising our results. Since Nestle uses nested sampling, we have to resample with weights to obtain the posteriors.</p>
<div class="codehilite"><pre><span></span><code><span class="n">weights</span> <span class="o">=</span> <span class="n">results_predict</span><span class="o">.</span><span class="n">weights</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">results_predict</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">weights</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># collect posterior samples</span>
<span class="n">samples_nestle</span> <span class="o">=</span> <span class="n">results_predict</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">mask</span><span class="p">,:]</span>
<span class="c1"># collect posterior means</span>
<span class="n">predict_param_mu_nestle</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_nestle</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="c1"># collect samples for posterior predictive plot</span>
<span class="n">nfits</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">predict_param_samples_nestle</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">samples_nestle</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">nfits</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="n">predict_post_samples_nestle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predict_param_samples</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>


<h3 id="plotting-the-posterior_1">Plotting the posterior</h3>
<p>Let's start by making a comparison between the posteriors from Zeus and Nestle. Below I'll create two plots. The first will show the mean posterior predictions of the second solar cycle, from both Zeus and Nestle. The second plot will show the posterior predictive plots, for both samplers also.</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># plot mean posterior plot</span>
<span class="n">new_param_mu_zeus</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">*</span><span class="n">predict_param_mu</span><span class="p">)</span>
<span class="n">new_param_mu_nestle</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">*</span><span class="n">predict_param_mu_nestle</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Data&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">new_param_mu_zeus</span><span class="p">),</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Zeus Prediction&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">new_param_mu_nestle</span><span class="p">),</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nestle Prediction&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Average sunspot number for the solar cycles</span><span class="se">\n</span><span class="s2"> between 1934-1945&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot; with overfitted</span><span class="se">\n</span><span class="s2"> mean predicted models&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># posterior predictive plot</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_post_samples</span><span class="p">)):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">*</span><span class="n">predict_post_samples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predict_post_samples_nestle</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="mf">0.01</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Average sunspot number for the solar cycles</span><span class="se">\n</span><span class="s2"> between 1934-1945&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot; with overfitted</span><span class="se">\n</span><span class="s2"> posterior predictive plots&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_75_0.png" /></p>
<p>Whilst the posterior predictive plot looks a little messy, it tells us that the posterior predictives from Zeus and Nestle are difficult to tell apart, since they overlap so much. The mean posterior plot supports this, showing that the two samplers have no deviation over the entire cycle.</p>
<p>Finally, lets plot a posterior predictive plot that shows the evolution of the prediction accuracy over time. Below is a plot that shows predictions for the entire range of 4 solar cycles between 1923 and 1965.</p>
<div class="codehilite"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># plot data between 1923 and 1965</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">period</span><span class="p">],</span><span class="n">sqrtssn</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">period</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Data&quot;</span><span class="p">)</span>

<span class="c1"># plot first cycle posterior predictive, using Zeus samples</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">300</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post_samples</span><span class="p">)):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">post_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fitted Model&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># use first cycle posterior predictive to find second cycle posterior predictive</span>
<span class="n">new_pred</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_post_samples_nestle</span><span class="p">)):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">param_mu</span><span class="p">,</span><span class="o">*</span><span class="n">predict_post_samples_nestle</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">new_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted Model&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># use second cycle posterior predictive to find third cycle posterior predictive</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>
<span class="n">new_pred2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_post_samples_nestle</span><span class="p">)):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">new_pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">predict_param_mu_nestle</span><span class="p">)</span>
    <span class="n">new_pred2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># use third cycle posterior predictive to find fourth cycle posterior predictive</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">peaktimes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predict_post_samples</span><span class="p">)):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">predict_cycle</span><span class="p">(</span><span class="n">new_pred2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">predict_param_mu_nestle</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date / years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Square Root of Sunspot Number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predictions of average sunspot number between 1934-1965,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
          <span class="s2">&quot; using the cycle between 1923-1934 to make predictions&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1923</span><span class="p">,</span><span class="mi">1967</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">leg</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lh</span> <span class="ow">in</span> <span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">:</span> 
    <span class="n">lh</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<p><img alt="png" src="../output_77_0.png" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../LightCurve/LightCurve/" title="Exoplanet Light Curve Analysis with emcee and UltraNest" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Exoplanet Light Curve Analysis with emcee and UltraNest
              </div>
            </div>
          </a>
        
        
          <a href="../../gravwaves/gravwaves/" title="Gravitational Wave Parameter Estimation with bilby" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Gravitational Wave Parameter Estimation with bilby
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.92ffa368.min.js"></script>
      <script src="../../assets/javascripts/bundle.5123e3d4.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
      
    
  </body>
</html>